---
title: "Bayer Execise 1"
author: "Borja"
date: "16/3/2022"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rpart)
library(rpart.plot)
library(kableExtra)
```

##### Exercise 1

```{r, echo = F}
df <- read.csv("data/real_case/data_usecase.csv", sep = ';')
head(df)
summary(df)
df$years_since_graduation <- as.numeric(df$years_since_graduation)
print(paste('Mean reads:',mean(df$Message_read)))
print(paste('Mean clicks: ',mean(df$Message_click)))
```

Clean NAs

```{r}
df_nona <- na.omit(df)
dim(df)
dim(df_nona)
```

Little visualization:

```{r, echo = F}
interest_features <- c("Message_type","Message_TA","office_or_hospital_based","gender","is_cardiologist","is_gp","years_since_graduation")
print(paste('Feature: ',interest_features[1]))
data.frame(table(df_nona[interest_features[1]])) %>% kbl() %>%  kable_paper("hover", full_width = F)
print(paste('Feature: ',interest_features[2]))
data.frame(table(df_nona[interest_features[2]])) %>% kbl() %>%  kable_paper("hover", full_width = F)
print(paste('Feature: ',interest_features[3]))
data.frame(table(df_nona[interest_features[3]])) %>% kbl() %>%  kable_paper("hover", full_width = F)
print(paste('Feature: ',interest_features[4]))
data.frame(table(df_nona[interest_features[4]])) %>% kbl() %>%  kable_paper("hover", full_width = F)
print(paste('Feature: ',interest_features[5]))
data.frame(table(df_nona[interest_features[5]])) %>% kbl() %>%  kable_paper("hover", full_width = F)
print(paste('Feature: ',interest_features[6]))
data.frame(table(df_nona[interest_features[6]])) %>% kbl() %>%  kable_paper("hover", full_width = F)
plot(density(df_nona[interest_features[7]]$years_since_graduation), main = "Density function years since graduation")
```

There are some unbalanced feature but since there are not extreme cases we are good to go. 

Option A: Decision tree

```{r, echo = F}
feature_read <- 'Message_read'
feature_clicked <- 'Message_click'
c("Message_type","Message_TA","office_or_hospital_based","gender","is_cardiologist","is_gp","years_since_graduation")
formula <- Message_read ~ Message_type + Message_TA + office_or_hospital_based+gender+is_cardiologist+is_gp+years_since_graduation
tree <- rpart(formula = formula, data = df_nona, control =rpart.control(cp = 1e-5, maxdepth = 5), method = 'class')
rpart.plot(tree) 
```

By looking at the tree we can say that send messages to:
* Cardiologist with equal or more than 13 years of experience
* Not about - Biotech, clinical trial update
* In areas - Global, Oncology, Ophthalmology or Else

Can be a good sales movement since people with this profile represent the 37% of our total sample and the probability of getting a read is around 0.51 which is 0.50.

Nevertheless, we should be more interested in getting clickes the more cliques we get the more sales we can potentially obtain.

```{r, echo = F}
feature_read <- 'Message_read'
feature_clicked <- 'Message_click'
c("Message_type","Message_TA","office_or_hospital_based","gender","is_cardiologist","is_gp","years_since_graduation")
formula <- Message_click ~ Message_type + Message_TA + office_or_hospital_based+gender+is_cardiologist+is_gp+years_since_graduation
tree <- rpart(formula = formula, data = df_nona, control =rpart.control(cp = 1e-5, maxdepth = 5), method = 'class')
rpart.plot(tree) 
```


